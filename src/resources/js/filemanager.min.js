function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),FileManager=function(){function e(){_classCallCheck(this,e),this.doms={sidebar:"#filemanager-sidebar",content:"#filemanager-content",folder:".folder",file:".file",modalPreview:"#filemanager-media-preview"},this.url=location.href.replace("#",""),this.media=location.href.replace("#",""),this.addition="",this._token=null,this.callback=null,this.routes={active:null,load:{sidebar:"/get/sidebar/",content:"/get/content/"},actions:{edit:"/action/edit",delete:"/action/delete",upload:"/action/upload",new:"/action/new"}},this.actions=["edit","delete","crop"],this.loadTriggers()}return _createClass(e,[{key:"modal",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;$(this.doms.modalPreview).modal("show"),$(this.doms.modalPreview).find(".modal-dialog").css("max-width","80%").find(".modal-body").html("\n            <div class='row' id=\"filemanager\">\n                <div class='col-3' id='"+this.doms.sidebar.replace("#","").replace(".","")+"'>\n                </div>\n                <div class='col' id='"+this.doms.content.replace("#","").replace(".","")+"'>\n                </div>\n            </div>\n        "),this.loadSidebar(),this.loadContent(),this.callback=e}},{key:"loadSidebar",value:function(){var e=this;$(this.doms.sidebar).html('<div class="loader"></div>'),$.get(this.url+this.routes.load.sidebar+this.addition,function(t){$(e.doms.sidebar).html(t)})}},{key:"loadContent",value:function(){var e=this;$(this.doms.content).html('<div class="loader"></div>'),$.get(this.url+this.routes.load.content+this.addition,function(t){$(e.doms.content).html(t)})}},{key:"loadTriggers",value:function(){var e=this;$(document).on("click",this.doms.sidebar+" "+this.doms.folder,function(t){t.preventDefault(),e.triggeredFolder($(this))}),$(document).on("dblclick",this.doms.content+" "+this.doms.folder,function(t){t.preventDefault(),e.triggeredFolder($(this))}),$(document).on("dblclick",this.doms.content+" "+this.doms.file,function(t){t.preventDefault(),e.triggeredFile($(this))}),$(document).on("click",this.doms.content+" "+this.doms.folder,function(t){t.preventDefault(),e.clickedFolder($(this))}),$(document).on("click",this.doms.content+" "+this.doms.file,function(t){t.preventDefault(),e.clickedFile($(this))}),$(document).on("submit","#action-form",function(t){t.preventDefault(),$.post($(this).attr("action"),$(this).serialize(),function(){$(e.doms.modalPreview).modal("hide"),e.loadContent(),e.loadSidebar()})}),$(document).on("click",this.doms.content+" [data-action='edit']",function(t){e.actionEdit(t,$(this))}),$(document).on("click",this.doms.content+" [data-action='delete']",function(t){e.actionDelete(t,$(this))}),$(document).on("click",this.doms.content+" [data-action='upload']",function(t){e.actionUpload(t,$(this))}),$(document).on("click",this.doms.content+" [data-action='new']",function(t){e.actionNewFolder(t,$(this))})}},{key:"triggeredFolder",value:function(e){this.addition="?folder="+e.data("route"),$(this.doms.folder).removeClass("active"),$('a[data-route="'+e.data("route")+'"]').addClass("active"),this.loadContent()}},{key:"triggeredFile",value:function(e){if("function"==typeof this.callback)return $(this.doms.modalPreview).modal("hide"),this.callback(this.media+"/"+e.data("route"));this.addition="?file="+e.data("route"),$(this.doms.modalPreview).find(".modal-body").html('<div class="loader"></div>'),$(this.doms.modalPreview).find(".modal-body").html('\n            <img src="'+this.url+this.addition+'" class="img-fluid">\n        '),$(this.doms.modalPreview).modal("show")}},{key:"clickedFolder",value:function(e){$(".activeFolder").removeClass("activeFolder"),$(".activeFile").removeClass("activeFile"),e.addClass("activeFolder"),this.enableAction("edit","delete")}},{key:"clickedFile",value:function(e){$(".activeFile").removeClass("activeFile"),$(".activeFolder").removeClass("activeFolder"),e.addClass("activeFile"),this.enableAction("edit","delete","crop")}},{key:"enableAction",value:function(){this.disableAction(this.actions);for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];$.each(t,function(e,t){$('[data-action="'+t+'"]').prop("disabled",!1)})}},{key:"disableAction",value:function(e){$.each(e,function(e,t){$('[data-action="'+t+'"]').prop("disabled",!0)})}},{key:"actionEdit",value:function(e){e.preventDefault();var t=this.doms.modalPreview,i=$(".activeFile").length>0?"file":"folder",o=$(".activeFile").length>0?"activeFile":"activeFolder";$(this.doms.modalPreview).find(".modal-body").html('\n            <br>\n            <form id="action-form" method="post" action="'+this.url+this.routes.actions.edit+'">\n                <input type="hidden" name="type" value="'+i+'">\n                <input type="hidden" name="route" value="'+$("."+o).data("route")+'">\n                <input type="hidden" name="_token" value="'+this._token+'">\n                <div class="row">\n                    <div class="col-12">\n                        <input type="text" name="rename" placeholder="Rename..." required="true" class="form-control" value="'+$("."+o).find("."+i+"-name").html()+'">\n                    </div>\n                    <div class="col-12">\n                        <br> \n                        <button type="submit" class="btn btn-success">Save</button>\n                    </div>\n                </div>\n            </form>\n        '),$(t).modal("show")}},{key:"actionDelete",value:function(e,t){e.preventDefault();var i=this;swal({title:"Are you sure?",type:"warning",showCancelButton:!0}).then(function(e){if(e.value){var t=$(".activeFile").length>0?$(".activeFile"):$(".activeFolder"),o=$(".activeFile").length>0?"file":"folder";$.post(i.url+i.routes.actions.delete,{type:o,_token:i._token,route:t.data("route"),_method:"delete"},function(){i.loadContent(),i.loadSidebar(),i.actionFinished("Deleted","Your file has been deleted.")})}})}},{key:"actionUpload",value:function(e,t){e.preventDefault();var i=this;$(this.doms.modalPreview).find(".modal-body").html('\n            <form class="dropzone" id="fileUploadForm"><input type="hidden" name="_token" value="'+this._token+'"><input type="hidden" name="folder" value="'+this.addition+'"></form>\n        ');new Dropzone("#fileUploadForm",{url:this.url+this.routes.actions.upload});Dropzone.options.fileUploadForm={init:function(){this.on("complete",function(e){0===this.getUploadingFiles().length&&0===this.getQueuedFiles().length&&i.loadContent()})}},$(this.doms.modalPreview).modal("show")}},{key:"actionNewFolder",value:function(){$(this.doms.modalPreview).find(".modal-body").html('\n            <br>\n            <form id="action-form" method="post" action="'+this.url+this.routes.actions.new+'">\n                <input type="hidden" name="folder" value="'+this.addition+'">\n                <input type="hidden" name="_token" value="'+this._token+'">\n                <div class="row">\n                    <div class="col-12">\n                        <input type="text" name="name" placeholder="Folder..." required="true" class="form-control">\n                    </div>\n                    <div class="col-12">\n                        <br> \n                        <button type="submit" class="btn btn-success">Save</button>\n                    </div>\n                </div>\n            </form>\n        '),$(this.doms.modalPreview).modal("show")}},{key:"actionFinished",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"success";swal(e,t,i)}},{key:"root",set:function(e){this.addition="?folder="+e,this.loadContent()}},{key:"baseUrl",set:function(e){this.url=e}},{key:"mediaUrl",set:function(e){this.media=e}},{key:"sidebar",set:function(e){this.doms.sidebar=e}},{key:"content",set:function(e){this.doms.content=e}},{key:"token",set:function(e){this._token=e}}]),e}();